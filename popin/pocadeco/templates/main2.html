<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
    <title>í¬ì¹´ê¾¸ë¯¸ê¸° - PO-PIN</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            cursor: default; /* ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ì„œ ë³´ì´ë„ë¡ ì„¤ì •, JSì—ì„œ íŠ¹ì • ìƒí™©ì—ì„œ ìˆ¨ê¹€ */
        }

        /* ì²« ë²ˆì§¸ íŒŒì¼ì˜ í—¤ë” ìŠ¤íƒ€ì¼ ì ìš© */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1); 
            position: sticky;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-menu a:hover {
            color: #667eea;
            transform: translateY(-2px);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        .nav-menu a.active {
            color: #667eea;
        }

        .nav-menu a.active::after {
            width: 100%;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-outline {
            border: 2px solid #667eea;
            color: #667eea;
            background: transparent;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            text-align:center;
        }

        /* Editor Layout */
        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        .editor-main {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .editor-sidebar {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        /* Canvas Area */
        .canvas-container {
            position: relative;
            margin-bottom: 30px;
        }

        .canvas-area {
            max-width: 300px;
            aspect-ratio: 2 / 3;
            background: #f8f9ff;
            border: 3px dashed #ddd;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            cursor: pointer; /* ê¸°ë³¸ì ìœ¼ë¡œ í´ë¦­ ê°€ëŠ¥í•¨ì„ ë‚˜íƒ€ëƒ„ */
            transition: all 0.3s ease;
            margin: 0 auto;
        }

        .photo-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .canvas-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .canvas-placeholder {
            text-align: center;
            color: #666;
        }

        .canvas-placeholder i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .photo-preview {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        /* Tools */
        .tool-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
        }

        .tool-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        /* Sliders */
        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        /* Text Input */
        .text-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        }

        .text-input-group input[type="text"],
        .text-input-group select { /* select ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            height: 36px; /* ë²„íŠ¼ê³¼ ë†’ì´ ë§ì¶”ê¸° */
            appearance: none; /* ê¸°ë³¸ select ìŠ¤íƒ€ì¼ ì œê±° */
            background-color: white;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.6-6.4H18.9c-5%200-9.3%201.8-12.9%205.4s-5.4%207.9-5.4%2012.8c0%204.9%201.8%209.2%205.4%2012.8l114.8%20114.8a17.6%2017.6%200%200%200%2012.9%205.4c4.9%200%209.2-1.8%2012.8-5.4l114.8-114.8c3.6-3.6%205.4-7.9%205.4-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%, 0 0;
            background-size: .65em auto, 100%;
        }

        .text-input-group button {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .text-input-group button:hover {
            background: #5a6cdb;
        }
        
        /* í…ìŠ¤íŠ¸ ì¶”ê°€ ë²„íŠ¼ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .add-text-button-container {
            margin-top: 15px; /* ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
            text-align: center; /* ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
        }
        .add-text-button-container .btn {
            width: 100%; /* ë„ˆë¹„ ê½‰ ì±„ìš°ê¸° */
            padding: 10px; /* íŒ¨ë”© ì¡°ì • */
            border-radius: 10px; /* ë²„íŠ¼ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
        }

        .frame-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .frame-option {
            aspect-ratio: 1;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .frame-option:hover, .frame-option.active {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        /* í”„ë ˆì„ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .frame-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .frame-preview.circle::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            border: 3px solid white;
        }

        .frame-preview.vintage::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 90%;
            background: linear-gradient(45deg, #8b4513, #daa520);
            border-radius: 8px;
            border: 2px solid #654321;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        .frame-preview.polaroid::before {
            content: '';
            position: absolute;
            width: 85%;
            height: 70%;
            background: white;
            border: 2px solid #ddd;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .frame-preview.polaroid::after {
            content: '';
            position: absolute;
            bottom: 15%;
            width: 85%;
            height: 20%;
            background: white;
            border: 2px solid #ddd;
            border-top: none;
        }

        .frame-preview.ornate::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 90%;
            background: linear-gradient(45deg,rgb(39, 198, 102), #e6d45a);
            border-radius: 15px;
            border: 3px solidrgb(133, 243, 36);
            box-shadow: inset 0 0 0 3px #ffd700, 0 0 10px rgba(0,0,0,0.3);
        }
        /* Stickers */
        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .sticker-btn {
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: white;
        }

        .sticker-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.1);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #e0e0e0;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* My Gallery */
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .add-photo-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-photo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .gallery-preview {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin-bottom: 10px;
            overflow: hidden;
        }

            .gallery-preview img,
            .gallery-item img {
            width: 100%;
            height: 80%;
            object-fit: cover;
            border-radius: 8px;
            display: block;
            }

        .gallery-info {
            text-align: center;
        }

        .gallery-title {
            font-weight: bold;
            margin:10px;
            
        }

        .gallery-date {
            color: #666;
            font-size: 10px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: none;
            transition: all 0.3s ease;
        }

        .gallery-item:hover .delete-btn {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .editor-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .frame-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .color-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Hidden file input */
        #fileInput, #galleryInput {
            display: none;
        }

        /* Preview Styles */
        .photo-container {
            position: relative;
            display: inline-block;
        }

        .photo-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sticker-overlay, .text-overlay {
            position: absolute;
            font-size: 30px; /* ì´ˆê¸° ìŠ¤í‹°ì»¤ í°íŠ¸ í¬ê¸° */
            cursor: grab; /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ì»¤ì„œ */
            user-select: none;
            z-index: 10;
            display: inline-block; /* ë„ˆë¹„/ë†’ì´ë¥¼ ë‚´ìš©ì— ë§ê²Œ */
            white-space: nowrap; /* ë‚´ìš©ì´ ì¤„ ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ */
            padding: 5px; /* ì¡°ì ˆ í•¸ë“¤ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì—¬ë°± */
            color: black; /* í…ìŠ¤íŠ¸ ê¸°ë³¸ ìƒ‰ìƒ */
        }

        .sticker-resize-handle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #667eea;
            border: 1px solid #fff;
            border-radius: 50%;
            bottom: -7px;
            right: -7px;
            cursor: nwse-resize; /* ëŒ€ê°ì„  í¬ê¸° ì¡°ì ˆ ì»¤ì„œ */
            z-index: 11; /* ìŠ¤í‹°ì»¤ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
        }

        /* í”„ë ˆì„ íš¨ê³¼ ìŠ¤íƒ€ì¼ */
        .frame-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 15px;
        }

        .frame-effect.circle {
            border: 10px solid;
            border-image: linear-gradient(45deg, #667eea, #764ba2) 1;
            border-radius: 50%;
        }

        .frame-effect.vintage {
            border: 8px solid;
            border-image: linear-gradient(45deg, #8b4513, #daa520) 1;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }

        .frame-effect.polaroid {
            border: 15px solid white;
            border-bottom: 40px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .frame-effect.ornate {
            border: 12px solid;
            border-image: linear-gradient(45deg, #c9b037, #e6d45a) 1;
            box-shadow: inset 0 0 0 3px #ffd700, 0 0 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">PO-PIN</div>
            <ul class="nav-menu">
                <li><a href="#home">í™ˆ</a></li>
                <li><a href="#exchange">í¬ì¹´êµí™˜</a></li>
                <li><a href="#community">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="#decorate" class="active">í¬ì¹´ê¾¸ë¯¸ê¸°</a></li>
                <li><a href="#customer">ê³ ê°ì§€ì›</a></li>
            </ul>
            <div class="auth-buttons">
                <a href="#" class="btn btn-outline">ë¡œê·¸ì¸</a>
                <a href="#" class="btn btn-primary">íšŒì›ê°€ì…</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="page-header">
                <h1 class="page-title">í¬í† ì¹´ë“œ ê¾¸ë¯¸ê¸°</h1>
            </div>

            <div class="editor-layout">
                <div class="editor-main">
                    <div class="canvas-container">
                        <div class="canvas-area" id="canvasArea" onclick="uploadPhoto()">
                            <div class="canvas-placeholder" id="placeholder">
                                <i>ğŸ“·</i>
                                <div>í¬í† ì¹´ë“œë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                                <small>í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•´ì„œ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</small>
                            </div>
                        </div>
                        <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="resetEditor()">ì´ˆê¸°í™”</button>
                        <button class="btn btn-primary" onclick="saveDecoration()">ì €ì¥í•˜ê¸°</button>
                        <button class="btn btn-success" onclick="downloadImage()">ë‹¤ìš´ë¡œë“œ</button>
                    </div>

                    <div style="margin-top: 40px;">
                        <div class="gallery-header">
                            <h2>ë‚´ í¬ê¾¸ ê°¤ëŸ¬ë¦¬</h2>
                            <button class="add-photo-btn" onclick="addToGallery()">
                                <span>ğŸ“·</span>
                                ì‚¬ì§„ ì¶”ê°€
                            </button>
                        </div>
                        <input type="file" id="galleryInput" accept="image/*" onchange="handleGalleryAdd(event)">
                        <div class="gallery-grid" id="myGallery">
                            <div class="gallery-item">
                                 <img src="images/hanni.jpg" />
                                <div class="gallery-info">
                                    <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">New Jeans í•˜ë‹ˆ</div>
                                    <div class="gallery-date">2024-06-12</div>
                                </div>
                                <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
                            </div>
                            <div class="gallery-item">
                                <img src="images/yushi.jpg" />
                                <div class="gallery-info">
                                    <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">Nct Wish ìœ ìš°ì‹œ</div>
                                    <div class="gallery-date">2024-06-11</div>
                                </div>
                                <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
                            </div>
                            <div class="gallery-item">
                                <img src="images/ì„¤ìœ¤.jpg" />
                                <div class="gallery-info">
                                    <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">NMIXX ì„¤ìœ¤</div>
                                    <div class="gallery-date">2024-06-09</div>
                                </div>
                                <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
                            </div>
                            <div class="gallery-item">
                                <img src="images/wonbin.jpg" />
                                <div class="gallery-info">
                                    <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">Rlize ì›ë¹ˆ</div>
                                <div class="gallery-date">2024-06-10</div>
                                </div>
                                <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="editor-sidebar">
                    <div class="tool-section">
                        <h3>âš™ï¸ ì¡°ì •</h3>
                        <div class="slider-group">
                            <label>ë°ê¸°</label>
                            <input type="range" class="slider" min="0" max="200" value="100" 
                                   oninput="adjustBrightness(this.value)">
                        </div>
                        <div class="slider-group">
                            <label>ëŒ€ë¹„</label>
                            <input type="range" class="slider" min="0" max="200" value="100" 
                                   oninput="adjustContrast(this.value)">
                        </div>
                        <div class="slider-group">
                            <label>ì±„ë„</label>
                            <input type="range" class="slider" min="0" max="200" value="100" 
                                   oninput="adjustSaturation(this.value)">
                        </div>
                    </div>

                    <div class="tool-section">
                        <h3>ğŸ–¼ï¸ í”„ë ˆì„</h3>
                        <div class="frame-grid">
                            <div class="frame-option" onclick="applyFrame('circle')">
                                <div class="frame-preview circle"></div>
                            </div>
                            <div class="frame-option" onclick="applyFrame('vintage')">
                                <div class="frame-preview vintage"></div>
                            </div>
                            <div class="frame-option" onclick="applyFrame('polaroid')">
                                <div class="frame-preview polaroid"></div>
                            </div>
                            <div class="frame-option" onclick="applyFrame('ornate')">
                                <div class="frame-preview ornate"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tool-section">
                        <h3>ğŸ“ í…ìŠ¤íŠ¸ ì…ë ¥</h3>
                        <div class="text-input-group">
                            <input type="text" id="textInput" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="text-input-group" style="margin-top: 10px;">
                            <label for="fontSelect" style="display: none;">ê¸€ê¼´ ì„ íƒ</label>
                            <select id="fontSelect">
                                <option value="Nanum Gothic, sans-serif">ë‚˜ëˆ”ê³ ë”•</option>
                                <option value="Noto Sans KR, sans-serif">ë³¸ê³ ë”•</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Times New Roman, serif">Times New Roman</option>
                            </select>
                        </div>
                        <div class="add-text-button-container">
                            <button class="btn btn-primary" onclick="addText()">í…ìŠ¤íŠ¸ ì¶”ê°€</button>
                        </div>
                    </div>

                    <div class="tool-section">
                        <h3>ğŸŒŸ ìŠ¤í‹°ì»¤</h3>
                        <div class="sticker-grid">
                            <div class="sticker-btn" onclick="addSticker('ğŸ’–')">ğŸ’–</div>
                            <div class="sticker-btn" onclick="addSticker('â­')">â­</div>
                            <div class="sticker-btn" onclick="addSticker('âœ¨')">âœ¨</div>
                            <div class="sticker-btn" onclick="addSticker('ğŸ’­')">ğŸ’­</div>
                            <div class="sticker-btn" onclick="addSticker('ğŸ’¤')">ğŸ’¤</div>
                            <div class="sticker-btn" onclick="addSticker('ğŸ’¢')">ğŸ’¢</div>
                            <div class="sticker-btn" onclick="addSticker('ğŸ’«')">ğŸ’«</div>
                            <div class="sticker-btn" onclick="addSticker('ğŸ¹')">ğŸ¹</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
function uploadPhoto() {
    const canvas = document.getElementById('canvasArea');
    const existingPhoto = canvas.querySelector('.photo-preview'); // ì´ë¯¸ ì‚¬ì§„ì´ ìˆëŠ”ì§€ í™•ì¸
    if (existingPhoto) {
        // ì´ë¯¸ ì‚¬ì§„ì´ ìˆìœ¼ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ (ì²¨ë¶€ ì°½ ëœ¨ì§€ ì•ŠìŒ)
        return;
    }
    document.getElementById('fileInput').click();
}

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const canvas = document.getElementById('canvasArea');
            // ê¸°ì¡´ ì´ë¯¸ì§€ì™€ ìŠ¤í‹°ì»¤, í”„ë ˆì„, í…ìŠ¤íŠ¸ ì œê±°
            canvas.innerHTML = ''; 
            canvas.style.border = '3px dashed #ddd'; // í…Œë‘ë¦¬ ì´ˆê¸°í™”
            canvas.appendChild(Object.assign(document.createElement('img'), {
                src: e.target.result,
                className: 'photo-preview',
                id: 'uploadedPhoto'
            }));
            // í•„í„° ì´ˆê¸°í™”
            brightness = 100;
            contrast = 100;
            saturation = 100;
            updateFilters();
            // ìŠ¬ë¼ì´ë”ë„ ì´ˆê¸°í™”
            document.querySelectorAll('.slider').forEach(slider => slider.value = 100);
            // í”„ë ˆì„ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.frame-option').forEach(option => option.classList.remove('active'));
            
            // í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            const textInput = document.getElementById('textInput');
            if (textInput) textInput.value = '';

            // ì‚¬ì§„ ì—…ë¡œë“œ í›„ ë§ˆìš°ìŠ¤ ì»¤ì„œ ìˆ¨ê¸°ê¸° (body ì „ì²´)
            document.body.style.cursor = 'none';
            // ìº”ë²„ìŠ¤ ì˜ì—­ì˜ ì»¤ì„œë„ ìˆ¨ê¹€
            canvas.style.cursor = 'none'; // ADDED THIS LINE
        };
        reader.readAsDataURL(file);
    }
}

function resetEditor() {
    const canvas = document.getElementById('canvasArea');
    canvas.innerHTML = `
        <div class="canvas-placeholder" id="placeholder">
            <i>ğŸ“·</i>
            <div>í¬í† ì¹´ë“œë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
            <small>í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•´ì„œ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</small>
        </div>`;
    canvas.style.border = '3px dashed #ddd'; // í…Œë‘ë¦¬ ì´ˆê¸°í™”
    canvas.style.cursor = 'pointer'; // RESET CANVAS CURSOR

    // í•„í„° ì´ˆê¸°í™”
    brightness = 100;
    contrast = 100;
    saturation = 100;
    // img ìš”ì†Œê°€ ì—†ìœ¼ë¯€ë¡œ updateFiltersëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ

    // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
    document.querySelectorAll('.slider').forEach(slider => slider.value = 100);
    // í”„ë ˆì„ ë²„íŠ¼ ì´ˆê¸°í™”
    document.querySelectorAll('.frame-option').forEach(option => option.classList.remove('active'));
    
    // í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    const textInput = document.getElementById('textInput');
    if (textInput) textInput.value = '';
    
    // ì—ë””í„° ì´ˆê¸°í™” ì‹œ ë§ˆìš°ìŠ¤ ì»¤ì„œ ë‹¤ì‹œ ë³´ì´ê²Œ í•¨ (body ì „ì²´)
    document.body.style.cursor = 'default';
}

function saveDecoration() {
    const canvasEl = document.getElementById('canvasArea');
    const img = canvasEl.querySelector('.photo-preview');
    if (!img) {
        alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
        return;
    }

    const title = prompt("í¬ê¾¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:");
    if (!title) return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•˜ë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ

    // html2canvasë¥¼ ì‚¬ìš©í•˜ì—¬ canvasAreaì˜ ë‚´ìš©ì„ ì´ë¯¸ì§€ë¡œ ë Œë”ë§
    html2canvas(canvasEl, {
        allowTaint: true, // í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„ ì´ë¯¸ì§€ ì²˜ë¦¬ í—ˆìš© (í•„ìš”ì‹œ)
        useCORS: true // CORS ë¬¸ì œ í•´ê²° (í•„ìš”ì‹œ)
    }).then(canvas => {
        const imgDataUrl = canvas.toDataURL('image/png'); // PNG ì´ë¯¸ì§€ ë°ì´í„° URL
        
        const gallery = document.getElementById('myGallery');
        const now = new Date().toISOString().split('T')[0];

        const item = document.createElement('div');
        item.className = 'gallery-item';
        item.innerHTML = `
            <img src="${imgDataUrl}" />
            <div class="gallery-info">
                <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">${title}</div>
                <div class="gallery-date">${now}</div>
            </div>
            <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
        `;
        gallery.prepend(item); // ê°¤ëŸ¬ë¦¬ ê°€ì¥ ì•ì— ì¶”ê°€
        document.body.style.cursor = 'none'; // ì €ì¥ í›„ ì»¤ì„œ ë‹¤ì‹œ ìˆ¨ê¹€
    }).catch(error => {
        console.error('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        document.body.style.cursor = 'none'; // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì»¤ì„œ ìˆ¨ê¹€
    });
}

function downloadImage() {
    const canvasEl = document.getElementById('canvasArea');
    const img = canvasEl.querySelector('.photo-preview');
    if (!img) {
        alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
        return;
    }

    html2canvas(canvasEl, {
        allowTaint: true,
        useCORS: true
    }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = 'poca_decorated.png';
        link.click();
        document.body.style.cursor = 'none'; // ë‹¤ìš´ë¡œë“œ í›„ ì»¤ì„œ ë‹¤ì‹œ ìˆ¨ê¹€
    }).catch(error => {
        console.error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        alert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        document.body.style.cursor = 'none'; // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì»¤ì„œ ìˆ¨ê¹€
    });
}

function addToGallery() {
    document.getElementById('galleryInput').click();
}

function handleGalleryAdd(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function (e) {
        const gallery = document.getElementById('myGallery');
        const item = document.createElement('div');
        item.className = 'gallery-item';

        const now = new Date().toISOString().split('T')[0];

        item.innerHTML = `
            <img src="${e.target.result}" />
            <div class="gallery-info">
                <div class="gallery-title" ondblclick="makeTitleEditable(this.parentElement)">ì¶”ê°€ëœ ì´ë¯¸ì§€</div>
                <div class="gallery-date">${now}</div>
            </div>
            <button class="delete-btn" onclick="deleteGalleryItem(this)">Ã—</button>
        `;
        gallery.prepend(item);
    };
    reader.readAsDataURL(file);
}

function deleteGalleryItem(btn) {
    if (confirm("ì´ í¬í† ì¹´ë“œë¥¼ ê°¤ëŸ¬ë¦¬ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        btn.parentElement.remove();
    }
}

function makeTitleEditable(element) {
    const title = element.querySelector('.gallery-title');
    title.setAttribute('contenteditable', true);
    title.focus();
    // Blur ì´ë²¤íŠ¸ ë°œìƒ ì‹œ contenteditable ì†ì„± ì œê±°
    title.onblur = () => {
        title.removeAttribute('contenteditable');
    };
    // Enter í‚¤ ëˆŒë €ì„ ë•Œë„ í¸ì§‘ ì¢…ë£Œ
    title.onkeydown = (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); // ìƒˆ ì¤„ ë°©ì§€
            title.blur(); // í¸ì§‘ ì¢…ë£Œ
        }
    };
}

let brightness = 100;
let contrast = 100;
let saturation = 100;

function updateFilters() {
    const img = document.getElementById('uploadedPhoto');
    if (img) {
        img.style.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%)`;
    }
}

function adjustBrightness(val) {
    brightness = val;
    updateFilters();
}

function adjustContrast(val) {
    contrast = val;
    updateFilters();
}

function adjustSaturation(val) {
    saturation = val;
    updateFilters();
}

function applyFrame(styleName) {
    const canvas = document.getElementById('canvasArea');
    const img = canvas.querySelector('.photo-preview');
    if (!img) {
        alert('ì‚¬ì§„ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
        return;
    }

    // ê¸°ì¡´ í”„ë ˆì„ ì œê±°
    const existingFrame = canvas.querySelector('.frame-effect');
    if (existingFrame) existingFrame.remove();

    const frame = document.createElement('div');
    frame.className = `frame-effect ${styleName}`;
    canvas.appendChild(frame);

    // í™œì„±í™”ëœ í”„ë ˆì„ ë²„íŠ¼ í‘œì‹œ
    document.querySelectorAll('.frame-option').forEach(option => option.classList.remove('active'));
    event.currentTarget.classList.add('active');
}

let activeDraggable = null; // í˜„ì¬ ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ ì¤‘ì¸ ìš”ì†Œë¥¼ ì¶”ì 

function makeDraggableAndResizable(element) {
    const canvas = document.getElementById('canvasArea');
    const resizeHandle = element.querySelector('.sticker-resize-handle');

    let isDragging = false;
    let isResizing = false;
    let offsetX = 0, offsetY = 0;
    let initialWidth, initialHeight, initialX, initialY, initialFontSize;

    element.onmousedown = function (e) {
        e.stopPropagation(); // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
        activeDraggable = element; // í˜„ì¬ í™œì„± ìš”ì†Œ ì„¤ì •

        if (e.target === resizeHandle) {
            isResizing = true;
            initialX = e.clientX;
            initialY = e.clientY;
            initialWidth = element.offsetWidth;
            initialHeight = element.offsetHeight;
            initialFontSize = parseFloat(window.getComputedStyle(element).fontSize);
            element.style.cursor = 'nwse-resize';
            document.body.style.cursor = 'nwse-resize'; // ë°”ë”” ì»¤ì„œë„ ë³€ê²½
        } else {
            isDragging = true;
            offsetX = e.offsetX;
            offsetY = e.offsetY;
            element.style.cursor = 'grabbing';
            document.body.style.cursor = 'grabbing'; // ë°”ë”” ì»¤ì„œë„ ë³€ê²½
        }
        element.style.zIndex = 1000; // ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ ì¤‘ì—ëŠ” ìµœìƒìœ„ë¡œ
    };

    element.onmouseover = function() {
        if (!isDragging && !isResizing) {
            element.style.cursor = 'grab'; // ìŠ¤í‹°ì»¤/í…ìŠ¤íŠ¸ ìœ„ì— ìˆì„ ë•Œ
        }
    };
    element.onmouseout = function() {
        if (!isDragging && !isResizing) {
            element.style.cursor = ''; // ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒë¦¼ (ìƒìœ„ ìš”ì†Œì˜ ì»¤ì„œ ìƒì†)
        }
    };
    document.onmousemove = function (e) {
        if (!activeDraggable) return; // í™œì„± ë“œë˜ê·¸ ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë¦¬í„´

        const canvasRect = canvas.getBoundingClientRect();
        if (isDragging) {
            let newLeft = e.clientX - canvasRect.left - offsetX;
            let newTop = e.clientY - canvasRect.top - offsetY;

            // ìº”ë²„ìŠ¤ ì˜ì—­ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œí•œ
            newLeft = Math.max(0, Math.min(newLeft, canvasRect.width - element.offsetWidth));
            newTop = Math.max(0, Math.min(newTop, canvasRect.height - element.offsetHeight));
            
            element.style.left = newLeft + 'px';
            element.style.top = newTop + 'px';
        } else if (isResizing) {
            const deltaX = e.clientX - initialX;
            const deltaY = e.clientY - initialY;

            let newFontSize;
            if (initialWidth > 0 && initialHeight > 0) {
                const ratioX = (initialWidth + deltaX) / initialWidth;
                const ratioY = (initialHeight + deltaY) / initialHeight;
                newFontSize = initialFontSize * Math.max(ratioX, ratioY);
            } else { 
                newFontSize = initialFontSize + Math.max(deltaX, deltaY);
            }

            // ìµœì†Œ í°íŠ¸ í¬ê¸° ì œí•œ
            newFontSize = Math.max(12, newFontSize); 
            // ìµœëŒ€ í°íŠ¸ í¬ê¸° ì œí•œ (ìº”ë²„ìŠ¤ í¬ê¸° ëŒ€ë¹„)
            const maxAllowedFontSize = Math.min(canvasRect.width, canvasRect.height) * 0.3; // ìº”ë²„ìŠ¤ ì§§ì€ ë³€ì˜ 30% ì •ë„ë¡œ ì œí•œ
            newFontSize = Math.min(newFontSize, maxAllowedFontSize);

            element.style.fontSize = newFontSize + 'px';
        }
    };

    document.onmouseup = function () {
        isDragging = false;
        isResizing = false;
        if (activeDraggable) {
            activeDraggable.style.zIndex = 10; // ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ ëë‚˜ë©´ ê¸°ë³¸ z-indexë¡œ
            activeDraggable.style.cursor = 'grab'; // ì»¤ì„œ ì›ìƒ ë³µê·€
        }
        document.body.style.cursor = 'none'; // ë°”ë”” ì»¤ì„œ ë‹¤ì‹œ ìˆ¨ê¹€
        activeDraggable = null; // í™œì„± ìš”ì†Œ í•´ì œ
    };

    // ë”ë¸”í´ë¦­í•˜ë©´ ì‚­ì œ
    element.ondblclick = function (e) {
        e.stopPropagation(); // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
        if (confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            element.remove();
        }
    };
}


function addSticker(emoji) {
    const canvas = document.getElementById('canvasArea');
    const img = canvas.querySelector('.photo-preview');
    if (!img) {
        alert('ì‚¬ì§„ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
        return;
    }

    const sticker = document.createElement('div');
    sticker.className = 'sticker-overlay';
    sticker.textContent = emoji;
    
    // ì´ˆê¸° ìœ„ì¹˜ (ìº”ë²„ìŠ¤ ì¤‘ì•™ì— ê°€ê¹ê²Œ)
    const canvasRect = canvas.getBoundingClientRect();
    sticker.style.left = `${(canvasRect.width / 2) - 15}px`; // ìŠ¤í‹°ì»¤ í¬ê¸° ê³ ë ¤
    sticker.style.top = `${(canvasRect.height / 2) - 15}px`; // ìŠ¤í‹°ì»¤ í¬ê¸° ê³ ë ¤
    sticker.style.position = 'absolute';
    
    // í¬ê¸° ì¡°ì ˆ í•¸ë“¤ ì¶”ê°€
    const resizeHandle = document.createElement('div');
    resizeHandle.className = 'sticker-resize-handle';
    sticker.appendChild(resizeHandle);

    canvas.appendChild(sticker);
    makeDraggableAndResizable(sticker); // ìŠ¤í‹°ì»¤ì— ë“œë˜ê·¸ ë° í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ ë¶€ì—¬
    
    // ìŠ¤í‹°ì»¤ ì„ íƒ ì™„ë£Œ í›„ ë§ˆìš°ìŠ¤ ì»¤ì„œ ìˆ¨ê¸°ê¸°
    document.body.style.cursor = 'none';
}

function addText() {
    const textInput = document.getElementById('textInput');
    const textContent = textInput.value.trim();

    if (!textContent) {
        alert('ì…ë ¥í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    const canvas = document.getElementById('canvasArea');
    const img = canvas.querySelector('.photo-preview');
    if (!img) {
        alert('ì‚¬ì§„ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
        return;
    }

    const textElement = document.createElement('div');
    textElement.className = 'text-overlay'; // ìŠ¤í‹°ì»¤ì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼ì„ ê³µìœ 
    textElement.textContent = textContent;
    
    // ê¸€ê¼´ ì ìš©
    const fontSelect = document.getElementById('fontSelect');
    const selectedFont = fontSelect.value;
    textElement.style.fontFamily = selectedFont;

    // ì´ˆê¸° ìœ„ì¹˜ (ìº”ë²„ìŠ¤ ì¤‘ì•™ì— ê°€ê¹ê²Œ)
    const canvasRect = canvas.getBoundingClientRect();
    textElement.style.left = `${(canvasRect.width / 2) - 50}px`; // í…ìŠ¤íŠ¸ í¬ê¸° ê³ ë ¤
    textElement.style.top = `${(canvasRect.height / 2) - 15}px`; // í…ìŠ¤íŠ¸ í¬ê¸° ê³ ë ¤
    textElement.style.position = 'absolute';
    textElement.style.color = 'black'; // ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ
    
    // í¬ê¸° ì¡°ì ˆ í•¸ë“¤ ì¶”ê°€
    const resizeHandle = document.createElement('div');
    resizeHandle.className = 'sticker-resize-handle'; // ìŠ¤í‹°ì»¤ì™€ ë™ì¼í•œ í•¸ë“¤ ì‚¬ìš©
    textElement.appendChild(resizeHandle);

    canvas.appendChild(textElement);
    makeDraggableAndResizable(textElement); // í…ìŠ¤íŠ¸ì— ë“œë˜ê·¸ ë° í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ ë¶€ì—¬

    textInput.value = ''; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    document.body.style.cursor = 'none'; // í…ìŠ¤íŠ¸ ì¶”ê°€ í›„ ì»¤ì„œ ìˆ¨ê¸°ê¸°
}
</script>
</body>
</html>